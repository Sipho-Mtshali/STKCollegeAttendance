<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="transparentLogo.png">
    <title>STK College - Teacher Dashboard</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="teacher.js" defer></script>
    <link rel="stylesheet" href="teacher.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <img src="transparentLogo.png" alt="STK College Logo">
                </div>
                <div class="logo-text">
                    <h2>STK College</h2>
                    <p>Teacher Portal</p>
                </div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="pending">
                        <i class="fas fa-clock"></i>
                        <span>Pending Approval</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="history">
                        <i class="fas fa-history"></i>
                        <span>Attendance History</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="reports">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="page-title">
                    <h1 id="pageTitle">Teacher Dashboard</h1>
                    <p id="pageSubtitle">Welcome back! Here's your teaching summary.</p>
                </div>
                <div class="user-menu">
                    <div class="user-info">
                        <img src="https://ui-avatars.com/api/?name=Teacher+User&background=4f46e5&color=fff" alt="Teacher User">
                        <div>
                            <div id="userNameDisplay">Teacher User</div>
                            <small>Teacher</small>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </button>
                </div>
            </header>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section-content">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalStudents">0</h3>
                            <p>Total Students</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingApprovals">0</h3>
                            <p>Pending Approvals</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="todayAttendance">0</h3>
                            <p>Today's Attendance</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="attendanceRate">0%</h3>
                            <p>Overall Rate</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="content-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>Quick Actions</h2>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="btn btn-primary" onclick="showSection('pending')">
                                    <i class="fas fa-clock"></i> Review Pending
                                </button>
                                <button class="btn btn-secondary" onclick="exportTodayAttendance()">
                                    <i class="fas fa-download"></i> Today's Report
                                </button>
                                <button class="btn btn-secondary" onclick="showSection('reports')">
                                    <i class="fas fa-file-pdf"></i> Full Report
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Recent Activity</h2>
                        </div>
                        <div class="card-body">
                            <ul class="activity-list" id="activityList">
                                <!-- Activity data will be populated here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Approval Section -->
            <div id="pendingSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Pending Attendance Approval</h2>
                        <span class="action" onclick="loadPendingAttendance()">Refresh</span>
                    </div>
                    <div class="card-body">
                        <div class="filter-controls">
                            <div class="filter-control">
                                <label for="dateFilter">Filter by Date</label>
                                <input type="date" id="dateFilter" class="form-control" onchange="filterPendingAttendance()">
                            </div>
                            <div class="filter-control">
                                <label for="studentFilter">Filter by Student</label>
                                <input type="text" id="studentFilter" class="form-control" placeholder="Search student..." onkeyup="filterPendingAttendance()">
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Email</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingTableBody">
                                <!-- Pending data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Attendance History Section -->
            <div id="historySection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Attendance History</h2>
                        <span class="action" onclick="exportFullAttendance()">Export PDF</span>
                    </div>
                    <div class="card-body">
                        <div class="filter-controls">
                            <div class="filter-control">
                                <label for="historyDateFilter">Date Range</label>
                                <input type="date" id="historyDateFilter" class="form-control" onchange="filterAttendanceHistory()">
                            </div>
                            <div class="filter-control">
                                <label for="historyStudentFilter">Student</label>
                                <input type="text" id="historyStudentFilter" class="form-control" placeholder="Search student..." onkeyup="filterAttendanceHistory()">
                            </div>
                            <div class="filter-control">
                                <label for="statusFilter">Status</label>
                                <select id="statusFilter" class="form-control" onchange="filterAttendanceHistory()">
                                    <option value="all">All Status</option>
                                    <option value="approved">Approved</option>
                                    <option value="pending">Pending</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Email</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Approved By</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <!-- History data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="section-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Attendance Reports</h2>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Today's Report</h3>
                                </div>
                                <div class="card-body">
                                    <p>Generate and download today's attendance report</p>
                                    <button class="btn btn-primary" onclick="exportTodayAttendance()">
                                        <i class="fas fa-download"></i> Download Today's Report
                                    </button>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>Date Range Report</h3>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label for="startDate">Start Date</label>
                                        <input type="date" id="startDate" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="endDate">End Date</label>
                                        <input type="date" id="endDate" class="form-control">
                                    </div>
                                    <button class="btn btn-primary" onclick="exportDateRangeAttendance()">
                                        <i class="fas fa-download"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>Full Attendance Report</h3>
                                </div>
                                <div class="card-body">
                                    <p>Generate a comprehensive report of all attendance records</p>
                                    <button class="btn btn-secondary" onclick="exportFullAttendance()">
                                        <i class="fas fa-file-pdf"></i> Download Full Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>